(()=>{"use strict";function t(t,e,s){const a=document.createElement(t);if(e)for(const t in e)e.hasOwnProperty(t)&&a.setAttribute(t,e[t]);return s&&(a.textContent=s),a}class e{data=null;constructor({$target:t,data:e}){this.$target=t,this.data=e}showModal(t){this.setState(t)}setState(t){this.data=t,this.render()}closeModal(){document.querySelector(".modal-wrapper").remove(),this.setState({visible:!1,book:void 0}),document.documentElement.removeAttribute("style")}render(){if(this.data.book){console.log(this.data.book);const{title:e,datetime:s,contents:a,url:i}=this.data.book,n=s.split("T")[0].split("-"),o=t("div",{class:"modal-wrapper"},null),l=t("section",{class:"modal"},null),r=t("h2",{class:"book-title"},e),d=t("p",{class:"book-content"},a),h=t("a",{href:i,target:"_blank",title:"새창",class:"btn-link"},"Daum 검색"),c=t("p",{class:"book-datetime"},`\n      ${n[0]}.${n[1]}.${n[2]}\n      `),p=t("button",{type:"button",class:"btn-close"}),u=t("img",{src:"../img/icon-X.svg",alt:"닫기"});p.appendChild(u),l.appendChild(r),l.appendChild(d),l.appendChild(c),l.appendChild(h),l.appendChild(p),o.appendChild(l),this.$target.appendChild(o),document.documentElement.setAttribute("style","overflow:hidden"),document.addEventListener("keydown",(t=>{"Escape"===t.key&&this.closeModal()})),p.addEventListener("click",(t=>{this.closeModal()})),o.addEventListener("click",(t=>{"modal-wrapper"===t.target.className&&this.closeModal()}))}}}class s{data=null;constructor({$target:e}){const s=t("div");e.appendChild(s),this.$loading=s,this.data={show:!1},this.render()}show(){this.setState({show:!0})}hide(){this.setState({show:!1})}setState(t){this.data=t,this.render()}render(){if(this.$loading.innerHTML="",this.data.show){const e=t("p",{class:"loading"},"Loading");this.$loading.appendChild(e)}}}class a{$keywordHistory=null;data=null;constructor({$target:t,onSearch:e}){this.$target=t,this.onSearch=e,this.init()}getHistory(){const t=JSON.parse(localStorage.getItem("keyword"));return null===t?[]:t}getLastKeyword(){return this.getHistory()[0]}addKeyword(t){let e=this.getHistory();var s;e.unshift(t),s=e,e=Array.from(new Set(s)),e=e.slice(0,5),localStorage.setItem("keyword",JSON.stringify(e)),this.init()}init(){const t=this.getHistory();this.setState(t)}setState(t){this.data=t,this.render()}savedKeywordSearch(){this.$target.querySelectorAll("button").forEach((t=>{t.addEventListener("click",(()=>{const e=localStorage.getItem("sorting");this.onSearch(t.textContent,e||12)}))}))}render(){const e=this.$target.querySelector(".keyword");if(null!==e&&e.remove(),0!==this.data.length){const e=t("section",{class:"keyword"}),s=t("h3",null,"최근 검색어"),a=t("ol");this.data.map((e=>{const s=t("li"),i=t("button",null,e);s.appendChild(i),a.appendChild(s)})),e.appendChild(s),e.appendChild(a),this.$target.appendChild(e)}this.savedKeywordSearch()}}class i{constructor({$target:e,onSearch:s,keyword:a}){const i=t("select",{class:"count"},null);[12,24,48].map((e=>{let s=t("option",{value:e},`${e}개`);i.appendChild(s)})),e.appendChild(i),this.$select=i,this.onSearch=s,this.init(),i.addEventListener("change",(t=>{localStorage.setItem("sorting",i.value),this.init()}))}init(){const t=this.getSorting(),e=this.$select.querySelectorAll("option");let s;null!==t&&(s=Array.from(e).find((e=>e.value===t)),e.forEach((t=>{t.removeAttribute("selected")})),s.setAttribute("selected",""))}getSorting(){return localStorage.getItem("sorting")}}class n{constructor({$target:e,onSearch:s}){const n=t("div",{class:"search"}),o=t("h2",{class:"a11y-hidden"},"도서 검색"),l=t("form",{class:"search-form"}),r=t("label",{class:"a11y-hidden"},"검색"),d=t("input",{type:"search",placeholder:"책 이름을 입력하세요"}),h=t("button",{type:"submit"},"검색");l.appendChild(r),l.appendChild(d),n.appendChild(o),n.appendChild(l),e.appendChild(n),this.KeywordHistory=new a({$target:n,onSearch:s}),this.SortingCounter=new i({$target:l,onSearch:s,keyword:this.KeywordHistory.getLastKeyword()}),l.appendChild(h),l.addEventListener("submit",(t=>{t.preventDefault();const e=d.value.trim();if(""===e)d.value="";else{d.value=e;const t=this.SortingCounter.getSorting();s(e,t),this.KeywordHistory.addKeyword(e)}}))}}class o{$searchResult=null;data=null;constructor({$target:t,initialData:e,onClick:s,keyword:a,onNextPage:i}){this.$target=t,this.data=e,this.onClick=s,this.keyword=a,this.onNextPage=i}setState(t){this.data=t,this.render()}listObserver=new IntersectionObserver(((t,e)=>{t.forEach(((t,s)=>{t.isIntersecting&&t.intersectionRatio>=1&&(e.unobserve(t.target),Number(t.target.dataset.index)===this.data.length-1&&this.onNextPage())}))}),{threshold:1});render(){const e=this.data.length,s=this.$target.querySelector(".search-result");null!==s&&s.remove();const a=t("section",{class:"search-result"}),i=t("ul"),n=t("h2",null);n.innerHTML=0!==e?`<p>검색결과 <strong>${e}</strong></p>`:"검색결과가 없습니다.",a.appendChild(n),a.appendChild(i),this.$target.appendChild(a),this.data.forEach(((e,s)=>{const a=t("li"),n=t("button",{type:"button","data-index":s}),o=t("div",{class:"thumb-wrap"}),l=t("img",{src:e.thumbnail,alt:"","data-src":e.thumbnail}),r=t("p",{class:"book-title",title:e.title},e.title),d=t("p",{class:"book-contents"},e.contents.slice(0,80)),h=t("p",{class:"book-authors",title:e.authors},`저자: ${e.authors}`),c=t("p",{class:"book-publisher",title:e.publisher},`출판사: ${e.publisher}`);n.addEventListener("click",(t=>{const e=Number(t.currentTarget.getAttribute("data-index"));this.onClick(this.data[e])})),this.listObserver.observe(n),o.appendChild(l),n.appendChild(o),n.appendChild(r),n.appendChild(d),n.appendChild(h),n.appendChild(c),a.appendChild(n),i.appendChild(a)}))}}class l{data=[{title:"어린 왕자, 영원이 된 순간",desc:"인간에 대한 희망으로 창조한 생텍쥐페리의 세계",link:"#",publisher:"위즈덤하우스",author:"앙투안 드 생텍쥐페리",src:"../img/book01.jpg"},{title:"마이크로카피 2/e",desc:"UX 디자이너의 글쓰기",link:"#",publisher:"에이콘출판",author:"킨너렛 이프라",src:"../img/book02.jpg"},{title:"프론트엔드 성능 최적화 가이드",desc:"웹 개발 스킬을 한 단계 높여 주는",link:"#",publisher:"프로그래밍 인사이트",author:"유동균",src:"../img/book03.jpg"},{title:"기획자의 일",desc:"아이디어, 실행, 성과까지 일의 흥망성쇠를 좌우하는",link:"#",publisher:"비즈니스북스",author:"양은우",src:"../img/book04.jpg"}];current=0;constructor({$target:e}){const s=t("div",{class:"banner"}),a=t("ul");a.style.width=100*this.data.length+"%";const i=t("h2",{class:"a11y-hidden"},"추천 도서");this.data.map((e=>{const s=t("li"),i=t("article",{class:"book-article"}),n=t("div",{class:"book-content"}),o=t("p",{class:"book-desc"},e.desc),l=t("h3",{class:"book-title"},e.title),r=t("a",{class:"btn",href:e.link},"View"),d=t("span",{class:"material-symbols-outlined"},"north_east"),h=t("img",{src:e.src,alt:""});r.appendChild(d),n.appendChild(o),n.appendChild(l),n.appendChild(r),i.appendChild(n),i.appendChild(h),s.appendChild(i),a.appendChild(s)}));const n=t("button",{class:"prev"}),o=t("span",{class:"a11y-hidden"},"prev"),l=t("span",{class:"material-symbols-outlined"},"Arrow_Back"),r=t("button",{class:"next"}),d=t("span",{class:"a11y-hidden"},"prev"),h=t("span",{class:"material-symbols-outlined"},"Arrow_Forward");n.appendChild(o),n.appendChild(l),r.appendChild(d),r.appendChild(h),s.appendChild(i),s.appendChild(a),s.appendChild(n),s.appendChild(r),e.appendChild(s),n.addEventListener("click",(()=>{let t=this.current-1;t<0||(0===t&&n.setAttribute("disabled",""),r.removeAttribute("disabled"),this.changeCurrent(t))})),r.addEventListener("click",(()=>{let t=this.current+1;t!==this.data.length&&(t===this.data.length-1&&r.setAttribute("disabled",""),n.removeAttribute("disabled"),this.changeCurrent(t))})),this.$prevButton=n,this.$nextButton=r,this.$ul=a,this.init()}changeCurrent(t){this.current=t,this.moveTo(t)}moveTo(t){let e=100*t;this.$ul.style.transform=`translateX(-${e}vw)`}init(){this.$prevButton.setAttribute("disabled","")}}const r="dark",d="light";class h{isDarkMode=null;constructor({$target:e}){const s=window.matchMedia("(prefers-color-scheme: dark)"),a=t("button",{type:"button",class:"toggle-theme"}),i=t("span",{class:"material-symbols-outlined"},"dark_mode"),n=t("span",{class:"a11y-hidden"},this.isDarkMode?"라이트 테마로 변경":"다크 테마로 변경");a.appendChild(i),a.appendChild(n),e.appendChild(a),this.$icon=i,this.$text=n,this.init(),s.addEventListener("change",(()=>{this.setState(s.matches),this.toggleButtonLabel()})),a.addEventListener("click",(()=>{this.setState(!this.isDarkMode),this.toggle()}))}setState(t){this.isDarkMode=t}toggleButtonLabel(){this.$text.textContent=this.isDarkMode?"라이트 테마로 변경":"다크 테마로 변경",this.$icon.textContent=this.isDarkMode?"light_mode":"dark_mode"}toggle(){const t=document.querySelector("html");this.isDarkMode?(t.setAttribute("class",r),localStorage.setItem("theme",r)):(t.setAttribute("class",d),localStorage.setItem("theme",d)),this.toggleButtonLabel()}init(){let t;try{t=localStorage.getItem("theme")}catch(t){console.error("Error localStorage",t)}null===t?(this.setState(window.matchMedia("(prefers-color-scheme: dark)").matches),this.toggleButtonLabel()):(this.setState(t===r),this.toggle())}}class c{constructor({$target:e}){const s=t("header",{class:"header"}),a=t("h1",{class:"h1"}),i=t("span",{class:"material-symbols-outlined",role:"img"},"book_4");a.textContent="Books",a.appendChild(i),s.appendChild(a),e.appendChild(s),new h({$target:s})}}class p{constructor({$target:e}){const s=t("div",{class:"visual"});e.appendChild(s),new c({$target:s}),new l({$target:s})}}const u={API_ENDPOINT:"https://dapi.kakao.com/v3/search/book",REST_API_KEY:process.env.REST_API_KEY},{API_ENDPOINT:g,REST_API_KEY:m}=u,b=async(t,e,s)=>{const a=new URLSearchParams({query:t,page:s||1,size:e||12});return(async t=>{try{const e=await fetch(t,{method:"GET",headers:{Authorization:`KakaoAK ${m}`}});if(200===e.status)return e.json();throw REQUEST_ERROR[e.status]}catch(t){return console.log(t.msg),{data:null}}})(`${g}?${a}`)};new class{$target=null;DEFAULT_PAGE=1;data={items:[],page:this.DEFAULT_PAGE};constructor(t){this.$target=t,this.Loading=new s({$target:t}),this.Visual=new p({$target:t}),new n({$target:t,onSearch:async(t,e)=>{this.Loading.show();const s=(await b(t,e)).documents;setTimeout((()=>{this.setState({items:s,page:this.DEFAULT_PAGE}),this.Loading.hide(),this.saveResult(s)}),300)}}),this.SearchResult=new o({$target:t,initialData:this.data.items,onClick:t=>{this.BookInfo.showModal({visible:!0,book:t})},onNextPage:async()=>{this.Loading.show();const t=JSON.parse(localStorage.getItem("keyword"))[0],e=Number(localStorage.getItem("sorting")),s=this.data.page+1,a=(await b(t,e,s)).documents;this.setState({items:[...this.data.items,...a],page:s}),setTimeout((()=>{this.Loading.hide()}),1e3)}}),this.BookInfo=new e({$target:t}),this.init()}setState(t){this.data=t,this.SearchResult.setState(t.items)}saveResult(t){localStorage.setItem("lastResult",JSON.stringify(t))}init(){const t=localStorage.getItem("lastResult"),e=null===t?[]:JSON.parse(t);this.setState({items:e,page:this.DEFAULT_PAGE})}}(document.querySelector("#app"))})();